---
layout: post
title: iOS代码评审：概要指南
categories: 技术

---

###阶段一：快速审查
对一个应用的整体状况有一个了解，需要做以下几件事：

* 确保工程中所需要的全部外部资源（如第三方库等）已被引入工程，或者通过子模块引入，或者使用cocoapods管理了。如果他们没有通过某种方式来统一管理，那么看是否有文档来描述如何获取和更新这些资源。
* 用Xcode打开工程并编译它，确保编译结果没有任何警告和错误。
* 在Xcode中进行静态分析(static analysis)看是否有问题出现。
* 运行oclint查看是否有静态分析未发现的其他问题出现。
* 检查工程的的结构。代码源文件是处在合理的层级中？工程越大，使用某些结构来组织文件层级就越重要，目的是方便外部人员能方便的找到目标文件。
* 工程中是否包含单元测试或集成测试？如果有，运行它们并确保结果无误。如果有通过工具来衡量测试的覆盖范围是加分点。

###阶段二：深入剖析
快速审查完毕后，从那些在快速审查阶段出现了大多数警告的代码开始对工程做一次更深入的检查。你应该查看每个源文件(如果有时间的话),通读所有代码。你可能需要在阅读代码的同时做一些笔记来记录需要优化的地方。

####Objective-C
* 是否使用了Objective-C的新特性？这包括隐式访问器(implicit accessor)和实例变量合成(instance variable synthesis)，新的简短语法(字面量)来创建NSNumber/NSArray/NSDictionary，新的获取数组和字典元素的语法(下标获取)。
* 实例变量和属性是否当做常量来使用？是否合理使用访问器(accessor)，在init和dealloc方法中直接访问实例变量而不是访问器？
* 属性的内存语义是否正确？（例如：copy和retain的使用是否合理）
* 类，方法和变量的命名是否合理？
* 是否存在太长的类？或者某些功能应该拆分到单独的类中？
* 在类中，是否有方法看起来太长，或者被正确的拆分？通常来说，方法越短越好。任何超过10或者15行的代码可能都需要重构，任何超过30或40行的代码几乎可以肯定需要重构。
* 工程使用的内存管理方式是ARC,MRC，或者两者混合？如果不是全部都用ARC，为什么？

####Cocoa
* 工程中是否妥善使用了通用的Cocoa设计模式，例如MVC,Notifacation,KVO,延迟加载(lazy-loading)等？是否使用了苹果之外，但是在iOS开发中被广泛认同的Reactive Cocoa和MVVM？
* ViewController是否承载了太多的职责？
* 如果某些功能模块需要与其他模块通信，是怎么实现的呢？有许多种方式能达到目的，例如KVO，Notification，全局变量(global variables)等，他们都有各自的适用场景。

####Model Layer
* 如果工程中使用了Core Data,数据模型是否充分规范化和可感知的？Core Data stack是否设定为在后台线程去工作？更多相关事项请参考Theo的[Guide to Core Data concurrency](https://robots.thoughtbot.com/tags/ios)。
* 如果没有使用Core Data,那工程是使用了哪些存储方案？是否合理？
* 最后，工程中是否避免了模型过大，并且像字典那样工作？

####GUI
* 界面创建是使用的xibs,storyboards,还是code?
* 界面布局是用得约束还是frame硬编码的？
* 应用运行起来后是否有合理的展示和感受？

####Network Layer
* 是否所有的网络请求都是异步请求，并且能够拿到返回结果？
* 如果使用了第三方的网络请求框架，这个框架是现代的，持续更新的，还是已经停止维护的？
* 如果没有使用第三方的网络请求框架，那苹果提供的类是否被很好的使用？
* 网络请求是否运行流畅，没有非预期的超时或网络延迟给用户造成困扰？

####Others
* 项目是否支持多国语言？如果支持，是不是采用的标准的iOS国际化技术？
* 如果代码中有棘手的问题，是否有文档描述？

以上所列的条目，有时不太可能都由确定yes/no的答案，仅仅是我目前能够想到的需要关注的地方，以供参考。



参考资料：[iOS Code Review:Loose Guidelines](https://robots.thoughtbot.com/ios-code-review-guidlines)